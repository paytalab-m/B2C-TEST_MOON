<script>
        /* ============================================================
           [0] 성과 추적 시스템
           ============================================================ */
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyBpxGQBFpImd8r5Xhr6vXkBQWVT2xQP25E-RO4-7jf88IpUb8obvhRnc8wZ8__4WpJcA/exec"; 

        const SESSION_ID = Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
        let trackData = {
            session_id: SESSION_ID,
            scan_time: new Date().toLocaleString('ko-KR'),
            company: "",
            store: "",
            btn1_click: "",
            btn1_time: "",
            btn2_click: "",
            btn2_time: "",
            phone: "",
            consent: ""
        };

        function sendLog() {
            if (!GOOGLE_SCRIPT_URL || GOOGLE_SCRIPT_URL.includes("XXXXXXXX")) return;
            fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                mode: "no-cors", 
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(trackData)
            }).then(() => console.log("로그 전송 완료"));
        }

        /* ============================================================
           [1] 데이터베이스
           ============================================================ */
        const projectData = {
            "한화에스테이트서비스": { company: "한화에스테이트서비스", store: "베러댄와플 동여의도점", addr: "서울특별시 영등포구 63로 32 (여의도동)", time: "3", dist: "111", price: "2500" },
            "소니세미컨덕터솔루션코리아(주)": { company: "소니세미컨덕터솔루션코리아(주)", store: "오브민 서울스퀘어점", addr: "서울특별시 중구 한강대로 416 (남대문로5가)", time: "1", dist: "0", price: "3800" },
            "주식회사 지애드스포츠": { company: "주식회사 지애드스포츠", store: "청춘커피 서래본점", addr: "서울특별시 서초구 사평대로22길 17 (반포동) 1층 청춘커피 서래본점", time: "4", dist: "300", price: "2800" },
            "(주)티엔엔터테인먼트": { company: "(주)티엔엔터테인먼트", store: "에센허브커피 논현점", addr: "서울특별시 강남구 언주로149길 17 (논현동)", time: "6", dist: "233", price: "2000" },
            "(주)브이에이코퍼레이션": { company: "(주)브이에이코퍼레이션", store: "에슬로우 도산대로점", addr: "서울특별시 강남구 도산대로30길 4 (논현동) 1층", time: "6", dist: "200", price: "2000" },
            "(주)뉴빌리티": { company: "(주)뉴빌리티", store: "호랭이카노", addr: "서울특별시 성동구 아차산로1길 10 (성수동1가)", time: "4", dist: "182", price: "3500" },
            "(주)바우라움": { company: "(주)바우라움", store: "타래커피 학동역지점", addr: "서울특별시 강남구 언주로129길 17 (논현동)", time: "5", dist: "204", price: "1900" },
            "주식회사휴머스온": { company: "주식회사휴머스온", store: "그릭베리 역삼언주점", addr: "서울특별시 강남구 언주로99길 10 (역삼동)", time: "1", dist: "60", price: "3500" },
            "주식회사 에스티씨랩": { company: "주식회사 에스티씨랩", store: "로지브라운", addr: "서울특별시 강남구 봉은사로37길 7-8(논현동)", time: "1", dist: "49", price: "3000" },
            "이데일리엠주식회사": { company: "이데일리엠주식회사", store: "카펫 서대문점", addr: "서울특별시 서대문구 통일로 103 (미근동)", time: "1", dist: "149", price: "2500" },
            "람다256(주)": { company: "람다256(주)", store: "에슬로우 강남역삼성타운점", addr: "서울특별시 서초구 서초대로74길 23 (서초동, 서초타운트라팰리스)", time: "3", dist: "99", price: "3300" },
            "주식회사논픽션": { company: "주식회사논픽션", store: "에슬로우 종각점", addr: "서울특별시 종로구 종로5길 7 (청진동)", time: "3", dist: "151", price: "2200" },
            "티디씨엑스코리아유한회사": { company: "티디씨엑스코리아유한회사", store: "에슬로우 종각점", addr: "서울특별시 종로구 종로5길 7 (청진동)", time: "3", dist: "151", price: "2200" },
            "에스케이텔레콤씨에스티원(주)": { company: "에스케이텔레콤씨에스티원(주)", store: "데쎄르룸", addr: "서울특별시 강남구 봉은사로51길 13(논현동)", time: "2", dist: "172", price: "3000" },
            "강남아이디안과": { company: "강남아이디안과", store: "와플샵 강남역사 신분당선점", addr: "서울특별시 강남구 강남대로 지하396 (역삼동)", time: "8", dist: "159", price: "2900" },
            "사우스케이프주식회사": { company: "사우스케이프주식회사", store: "에슬로우 대치1호점", addr: "서울특별시 강남구 테헤란로108길 19 (대치동)", time: "1", dist: "134", price: "3800" },
            "(주)네오아이즈": { company: "(주)네오아이즈", store: "커펙스브루", addr: "서울특별시 구로구 디지털로26길 43 (구로동)", time: "1", dist: "0", price: "2000" },
            "팀스파르타주식회사": { company: "팀스파르타주식회사", store: "마니달오 선릉본점", addr: "서울특별시 강남구 테헤란로52길 16 (역삼동, 테헤란아이파크)", time: "3", dist: "136", price: "1800" },
            "(주)그로비교육": { company: "(주)그로비교육", store: "더리터 사당점", addr: "서울특별시 동작구 동작대로7길 94 (사당동)", time: "2", dist: "124", price: "1800" },
            "에스오오주식회사": { company: "에스오오주식회사", store: "메종크로키", addr: "서울특별시 금천구 범안로 1130 (가산동)", time: "1", dist: "0", price: "2500" },
            "주식회사올리브인터내셔널": { company: "주식회사올리브인터내셔널", store: "sis coffee", addr: "서울특별시 서초구 서운로 138 (서초동, 서초동아타워)", time: "2", dist: "72", price: "2200" },
            "이씨유월드와이드코리아주식회사": { company: "이씨유월드와이드코리아주식회사", store: "메가커피 양평역점", addr: "서울특별시 영등포구 양산로 53 (양평동3가)", time: "1", dist: "0", price: "2000" },
            "주식회사 링게임즈": { company: "주식회사 링게임즈", store: "마니달오 논현점", addr: "서울특별시 강남구 학동로3길 7 (논현동) 1층 마니달오", time: "3", dist: "124", price: "1800" },
            "주식회사굿닥": { company: "주식회사굿닥", store: "케비쥬스 본점", addr: "서울특별시 서초구 강남대로 321 (서초동, 서초동대우디오빌프라임)", time: "4", dist: "134", price: "2500" },
            "주식회사 닥터나우": { company: "주식회사 닥터나우", store: "에슬로우 대치1호점", addr: "서울특별시 강남구 테헤란로108길 19 (대치동)", time: "4", dist: "230", price: "3800" },
            "(주)디버": { company: "(주)디버", store: "업즈커피", addr: "서울특별시 마포구 백범로 134-1 (염리동)", time: "4", dist: "187", price: "3000" },
            "주식회사에프피앤코(FP&Co.)": { company: "주식회사에프피앤코(FP&Co.)", store: "컴포즈커피 코엑스사거리점", addr: "서울특별시 강남구 영동대로112길 10 (삼성동)", time: "2", dist: "189", price: "1500" },
            "주식회사소모이앤티": { company: "주식회사소모이앤티", store: "커피인류 대치르엘점", addr: "서울특별시 강남구 도곡로93길 23 (대치동, 대치 르엘)", time: "2", dist: "131", price: "3800" },
            "주식회사빅플래닛메이드엔터": { company: "주식회사빅플래닛메이드엔터", store: "롬커피 본점", addr: "서울특별시 강남구 학동로50길 7 (논현동)", time: "2", dist: "128", price: "2800" },
            "(주)나일소프트": { company: "(주)나일소프트", store: "시드커피", addr: "서울특별시 구로구 디지털로32길 30 (구로동)", time: "1", dist: "0", price: "2800" },
            "(주)핫셀러": { company: "(주)핫셀러", store: "메가커피 장한평역점", addr: "서울특별시 동대문구 천호대로85길 10 (장안동)", time: "1", dist: "116", price: "2000" },
            "주식회사소이미디어": { company: "주식회사소이미디어", store: "카페 어거스트", addr: "서울특별시 강남구 선릉로 514 (삼성동)", time: "2", dist: "93", price: "2500" },
            "주식회사윈즈아이티서비스": { company: "주식회사윈즈아이티서비스", store: "포카코(foccaco)", addr: "서울특별시 강남구 영동대로 510 (삼성동)", time: "5", dist: "161", price: "4000" },
            "주식회사 퍼플아이오": { company: "주식회사 퍼플아이오", store: "순이네커피", addr: "서울특별시 강남구 선릉로90길 72(대치동)", time: "5", dist: "174", price: "2800" },
            "유한책임회사벨로시티글로벌코리아": { company: "유한책임회사벨로시티글로벌코리아", store: "켱순이네커피", addr: "서울특별시 강남구 선릉로90길 72(대치동)", time: "7", dist: "125", price: "2800" },
            "강남밝은미소안과": { company: "강남밝은미소안과", store: "쿨바이트(coolbite)", addr: "서울특별시 강남구 강남대로 지하396 (역삼동)", time: "4", dist: "135", price: "2500" },
            "주식회사바비톡": { company: "주식회사바비톡", store: "램커피", addr: "서울특별시 서초구 강남대로53길 8 (서초동)", time: "2", dist: "71", price: "2500" },
            "주식회사 테크타카": { company: "주식회사 테크타카", store: "램커피", addr: "서울특별시 서초구 강남대로53길 8 (서초동)", time: "1", dist: "0", price: "2500" },
            "오씨아이드림주식회사": { company: "오씨아이드림주식회사", store: "샐러디 서울시청점", addr: "서울특별시 중구 세종대로18길 20(북창동)", time: "3", dist: "200", price: "2400" },
            "힐러비(주)": { company: "힐러비(주)", store: "디저트39 지타워몰점", addr: "서울특별시 구로구 디지털로26길 38 (구로동)", time: "1", dist: "0", price: "2900" },
            "(주)스토리위즈": { company: "(주)스토리위즈", store: "텐퍼센트커피 안국점", addr: "서울특별시 종로구 율곡로 59(재동)", time: "1", dist: "51", price: "2000" },
            "엘본더테이블주식회사": { company: "엘본더테이블주식회사", store: "이터널스커피랩", addr: "서울특별시 강남구 삼성로100길 18 (삼성동)", time: "1", dist: "23", price: "3500" },
            "(주)제이드스튜디오스(JEDStudios)": { company: "(주)제이드스튜디오스(JEDStudios)", store: "로스터리락온 마곡1호점", addr: "서울특별시 강서구 마곡동로3길 26 (마곡동)", time: "1", dist: "31", price: "2500" },
            "미니쉬치과병원": { company: "미니쉬치과병원", store: "위클리베이글 도산공원사거리점", addr: "서울특별시 강남구 언주로 729 (논현동)", time: "2", dist: "63", price: "3000" },
            "(주)캐럿솔루션즈": { company: "(주)캐럿솔루션즈", store: "셀렉토커피 신논현점", addr: "서울특별시 서초구 강남대로79길 31 (반포동)", time: "3", dist: "125", price: "3200" },
            "에프피티소프트웨어코리아주식회사": { company: "에프피티소프트웨어코리아주식회사", store: "하와유카페", addr: "서울특별시 영등포구 은행로 60-1 (여의도동)", time: "1", dist: "85", price: "2500" },
            "주식회사 큐앤드비인터내셔날": { company: "주식회사 큐앤드비인터내셔날", store: "포케올데이 선정릉역점", addr: "서울특별시 강남구 봉은사로 333 (논현동, 선정릉역 모아엘가 퍼스트 홈)", time: "3", dist: "161", price: "2900" },
            "(주)조일테크놀로지": { company: "(주)조일테크놀로지", store: "매머드익스프레스 명동역3번출구점", addr: "서울특별시 중구 퇴계로18길 8 (남산동1가)", time: "2", dist: "147", price: "2000" },
            "주식회사 에이클라미디어그룹": { company: "주식회사 에이클라미디어그룹", store: "커스텀커피 상암점", addr: "서울특별시 마포구 월드컵북로54길 17 (상암동)", time: "2", dist: "56", price: "4300" },
            "주식회사크리에이션엘": { company: "주식회사크리에이션엘", store: "세컨스텝", addr: "서울특별시 동대문구 난계로30길 36-8 (신설동)", time: "3", dist: "199", price: "2500" },
            "(주)타임교육C&P": { company: "(주)타임교육C&P", store: "어반81(URBAN 81)", addr: "서울특별시 강남구 봉은사로67길 14(삼성동, 삼성동 468)", time: "5", dist: "152", price: "3500" },
            "주식회사 당근서비스": { company: "주식회사 당근서비스", store: "라이트닝커피", addr: "서울특별시 구로구 디지털로 306 (구로동)", time: "1", dist: "131", price: "2000" },
            "주식회사딜리버리랩": { company: "주식회사딜리버리랩", store: "누아흐", addr: "서울특별시 성동구 성수일로11길 15 (성수동1가)", time: "3", dist: "197", price: "3000" },
            "주식회사다이트랩": { company: "주식회사다이트랩", store: "청춘커피 논현점(신사점)", addr: "서울특별시 강남구 도산대로8길 16(논현동)", time: "8", dist: "196", price: "2500" },
            "메타넷사스 주식회사": { company: "메타넷사스 주식회사", store: "공차 두산연강빌딩점", addr: "서울특별시 종로구 종로33길 15 (연지동) 두산아트센터 1층", time: "1", dist: "4", price: "3900" },
            "(주)엠투엠글로벌": { company: "(주)엠투엠글로벌", store: "헬로우베이글 당산점", addr: "서울특별시 영등포구 영등포로 150 (당산동1가)", time: "2", dist: "30", price: "2500" },
            "퍼킨엘머코리아유한회사": { company: "퍼킨엘머코리아유한회사", store: "어반테이블", addr: "서울특별시 구로구 디지털로33길 27 (구로동)", time: "2", dist: "66", price: "1900" },
            "어썸엔터테인먼트(주)": { company: "어썸엔터테인먼트(주)", store: "커피사피엔스 성수현대테라스점", addr: "서울특별시 성동구 연무장5가길 7 (성수동2가)", time: "2", dist: "181", price: "2000" },
            "지에이치파트너즈주식회사": { company: "지에이치파트너즈주식회사", store: "죠샌드위치 대치사거리점", addr: "서울특별시 강남구 삼성로 345 (대치동)", time: "4", dist: "205", price: "3800" },
            "주식회사스파크펫": { company: "주식회사스파크펫", store: "이디야커피 청담역점", addr: "서울특별시 강남구 삼성로 721 (청담동)", time: "1", dist: "67", price: "3200" }
        };

        /* ============================================================
           [2] 데이터 바인딩 및 이미지 처리
           ============================================================ */
        function initPageData() {
            const params = new URLSearchParams(window.location.search);
            let code = params.get('code');

            if (!code || !projectData[code]) {
                code = "한화에스테이트서비스"; 
            }

            const data = projectData[code];

            const titleEl = document.querySelector('title');
            if(titleEl) titleEl.innerText = "패스오더 X " + data.company;
            
            if(document.getElementById('val-company-1')) document.getElementById('val-company-1').innerText = data.company;
            if(document.getElementById('val-company-2')) document.getElementById('val-company-2').innerText = data.company;
            if(document.getElementById('val-store-1')) document.getElementById('val-store-1').innerText = data.store;
            if(document.getElementById('val-store-2')) document.getElementById('val-store-2').innerText = data.store;
            if(document.getElementById('val-store-3')) document.getElementById('val-store-3').innerText = data.store;
            if(document.getElementById('val-addr')) document.getElementById('val-addr').innerText = data.addr;
            if(document.getElementById('val-time')) document.getElementById('val-time').innerText = data.time;
            if(document.getElementById('val-dist')) document.getElementById('val-dist').innerText = data.dist;
            if(document.getElementById('val-price')) {
                document.getElementById('val-price').innerText = Number(data.price).toLocaleString(); 
            }

            const mapImgEl = document.getElementById('val-map-img');
            if(mapImgEl) {
                const imgPath = "./images/" + data.company + ".jpg"; 
                mapImgEl.src = imgPath;
                mapImgEl.style.display = "block"; 
                mapImgEl.onerror = function() {
                    this.style.display = "none";
                };
            }

            trackData.company = data.company;
            trackData.store = data.store;
            sendLog(); 
        }
        initPageData();

        /* ============================================================
           [3] 이미지 확대/이동 (라이트박스)
           ============================================================ */
        let currentScale = 1;
        let translateX = 0;
        let translateY = 0;
        let initialDist = 0;
        let baseScale = 1;
        let startX = 0;
        let startY = 0;
        let lastX = 0;
        let lastY = 0;
        let imgElement = null;

        function updateTransform() {
            if(!imgElement) return;
            imgElement.style.transform = `translate(${translateX}px, ${translateY}px) scale(${currentScale})`;
        }

        function openImageModal() {
            const modal = document.getElementById("imgModal");
            const thumbImg = document.getElementById("val-map-img"); 
            const expandImg = document.getElementById("expandedImg"); 
            
            imgElement = expandImg;

            if (thumbImg.style.display === "none" || thumbImg.naturalWidth === 0) {
                alert("확대할 지도가 없습니다.");
                return;
            }

            modal.style.display = "flex"; 
            expandImg.src = thumbImg.src; 
            document.body.style.overflow = "hidden"; 

            currentScale = 1;
            translateX = 0;
            translateY = 0;
            lastX = 0;
            lastY = 0;
            updateTransform();
        }

        function closeImageModal() {
            const modal = document.getElementById("imgModal");
            modal.style.display = "none";
            document.body.style.overflow = "";
            currentScale = 1; 
            translateX = 0;
            translateY = 0;
            if(imgElement) updateTransform();
        }

        document.getElementById('imgModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeImageModal();
            }
        });

        /* ============================================================
           [4] 모달 및 데이터 전송
           ============================================================ */
        const modal = document.getElementById('infoModal');
        const phoneInput = document.getElementById('phoneInput');
        const agreeChk = document.getElementById('agreeChk');
        const submitBtn = document.getElementById('submitBtn');

        function openInfoModal() {
            if(trackData.btn1_click === "") { 
                trackData.btn1_click = "O";
                trackData.btn1_time = new Date().toLocaleString('ko-KR');
                sendLog(); 
            }
            modal.classList.add('active');
            document.body.style.overflow = 'hidden'; 
        }

        function closeModal() {
            modal.classList.remove('active');
            document.body.style.overflow = ''; 
            phoneInput.blur();
        }

        function checkValidation() {
            const phoneVal = phoneInput.value.replace(/[^0-9]/g, '');
            const isChecked = agreeChk.checked;
            if (phoneVal.length === 11 && isChecked) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }

        phoneInput.addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
            checkValidation();
        });

        agreeChk.addEventListener('change', checkValidation);

        function submitData() {
            trackData.btn2_click = "O";
            trackData.btn2_time = new Date().toLocaleString('ko-KR');
            trackData.phone = document.getElementById('phoneInput').value;
            trackData.consent = "Y"; 
            sendLog(); 
            modal.classList.remove('active');
            document.getElementById('successView').classList.add('active');
            setTimeout(function() {
                window.location.href = "https://passorder.app.link/app-download";
            }, 3000);
        }

        /* ============================================================
           [5] 이미지 줌 & 팬 + [NEW] 아이폰 전체화면 확대 방지
           ============================================================ */
        const expandImgElement = document.getElementById('expandedImg');
        
        // 1) 지도 이미지 확대/이동 로직
        if(expandImgElement) {
            expandImgElement.addEventListener('touchstart', function(e) {
                if (e.touches.length === 2) {
                    e.preventDefault();
                    initialDist = Math.hypot(
                        e.touches[0].pageX - e.touches[1].pageX,
                        e.touches[0].pageY - e.touches[1].pageY
                    );
                    baseScale = currentScale;
                } else if (e.touches.length === 1) {
                    startX = e.touches[0].pageX;
                    startY = e.touches[0].pageY;
                    lastX = translateX;
                    lastY = translateY;
                }
            }, { passive: false });

            expandImgElement.addEventListener('touchmove', function(e) {
                // 이미지 위에서의 제스처는 브라우저 기본 동작 무조건 막음 (확대/이동 전용)
                e.preventDefault();

                if (e.touches.length === 2) {
                    const currentDist = Math.hypot(
                        e.touches[0].pageX - e.touches[1].pageX,
                        e.touches[0].pageY - e.touches[1].pageY
                    );
                    if (initialDist > 0) {
                        const scaleFactor = currentDist / initialDist; 
                        currentScale = baseScale * scaleFactor;
                        if (currentScale < 1) currentScale = 1;
                        if (currentScale > 5) currentScale = 5;
                        updateTransform();
                    }
                } else if (e.touches.length === 1 && currentScale > 1) {
                    const dx = e.touches[0].pageX - startX;
                    const dy = e.touches[0].pageY - startY;
                    translateX = lastX + dx;
                    translateY = lastY + dy;
                    updateTransform();
                }
            }, { passive: false });
        }

        // 2) [중요] 아이폰에서 지도 외 다른 영역(body) 확대 방지
        document.body.addEventListener('touchmove', function(e) {
            // 두 손가락 터치(확대 시도)이면서 && 대상이 지도 이미지가 아니면
            if (e.touches.length > 1 && e.target.id !== "expandedImg") {
                // 강제로 무시해서 화면 확대를 막음
                e.preventDefault();
            }
        }, { passive: false });

        // 3) 더블 탭 확대 방지 (아이폰)
        let lastTouchEnd = 0;
        document.documentElement.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, { passive: false });
    </script>
